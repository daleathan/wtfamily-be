{% extends 'base.html' %}

{% block heading %}
    {{ obj.name }}
    <small>
      {% if obj._data.gender == 'M' %}
        <span class="icon-male">♂</span>
      {% elif obj._data.gender == 'F' %}
        <span class="icon-female">♀</span>
      {% endif %}
      {% if obj.birth %}☀{{ obj.birth }}{% endif %}
      &nbsp;
      {% if obj.death %}✝{{ obj.death }}{% endif %}
    </small>
{% endblock %}

{% block content %}

<dl class="dl-horizontal">
    {% if obj.names|length > 1 %}
        <dt>Варианты имён</dt>
        {% for name in obj.names %}
        <dd>{{ name }}</dd>
        {% endfor %}
    {% endif %}

    {% if obj.get_parent_families() or obj.get_families %}
        <p><a href="{{ url_for('familytree_primitives') }}#{{ obj.id }}">Посмотреть в семейном древе</a></p>
    {% else %}
        <p>Фактов о родителях или семьях нет, поэтому в семейном древе персона не отображается.</p>
    {% endif %}

    {% for family in obj.get_parent_families() %}
        <dt><a href="{{ url_for('family_detail', obj_id=family.id) }}">Семья родителей</a></dt>
        <dd>
            отец <a href="{{ url_for('person_detail', obj_id=family.father.id) }}">{{ family.father or '?'}}</a>
            {% if family.father.birth %}
                ({{ family.father.birth }})
            {% endif %}
        </dd>
        <dd>
            мать <a href="{{ url_for('person_detail', obj_id=family.mother.id) }}">{{ family.mother or '?'}}</a>
            {% if family.mother.birth %}
                ({{ family.mother.birth }})
            {% endif %}
        </dd>
        {% for child in family.children|sort(attribute='birth') %}
            <dd>
                {% if child.id == obj.id %}
                    <span class="bg-info">{{ child }}</span>
                {% else %}
                    <!-- note: roles relative to the central person -->
                    {% if child.gender == 'M'  %}брат{% elif child.gender == 'F' %}сестра{% endif %}
                    <a href="{{ url_for('person_detail', obj_id=child.id) }}">{{ child }}</a>
                    {% if child.birth %}
                        ({{ child.birth }})
                    {% endif %}
                {% endif %}
            </dd>
        {% endfor %}
    {% endfor %}

    {% for family in obj.get_families() %}
        <dt><a href="{{ url_for('family_detail', obj_id=family.id) }}">Семья</a></dt>
        <dd>
            {% if family.father.id == obj.id %}
                <span class="bg-info">{{ family.father }}</span>
            {% else %}
                муж
                <a href="{{ url_for('person_detail', obj_id=family.father.id) }}">
                    {{ family.father or '?' }}
                </a>
                {% if family.father.birth %}
                    ({{ family.father.birth }})
                {% endif %}
            {% endif %}
        </dd>
        <dd>
            {% if family.mother.id == obj.id %}
                <span class="bg-info">{{ family.mother }}</span>
            {% else %}
                жена
                <a href="{{ url_for('person_detail', obj_id=family.mother.id) }}">
                    {{ family.mother or '?' }}
                </a>
                {% if family.mother.birth %}
                    ({{ family.mother.birth }})
                {% endif %}
            {% endif %}
        </dd>
        {% for child in family.children %}
            <dd>
                {% if child.gender == 'M'  %}сын{% elif child.gender == 'F' %}дочь{% endif %}
                <a href="{{ url_for('person_detail', obj_id=child.id) }}">{{ child }}</a>
                {% if child.birth %}
                    ({{ child.birth }})
                {% endif %}
            </dd>
        {% endfor %}
    {% endfor %}

    {% for attr in obj.attributes %}
        <dt>{{ attr.type }}</dt>
        <dd>{{ attr.value }}</dd>
    {% endfor %}
</dl>

<!-- h2>Events</h2 -->

<table class="table table-striped table-hover">
  <tr>
    <th>ID</th>
    <th>Place</th>
    <th>Date</th>
    <th>Type</th>
    <th>Summary</th>
    <th>People</th>
    <th>Citations</th>
  </tr>
{% for event in obj.events|sort(attribute='date') %}
  <tr>
    <td>
      <a href="{{ url_for('event_detail', obj_id=event.id) }}">{{ event.id }}</a>
    </td>
    <td>
      {% if event.place %}
        <a href="{{ url_for('place_detail', obj_id=event.place.id) }}">{{ event.place }}</a>
      {% else %}
        ?
      {% endif %}
    </td>
    <td>
      {{ event.date }}
    </td>
    <td>
      {{ event.type }}
    </td>
    <td>
      {{ event.summary }}
    </td>
    <td>
      <ul>
      {% for p in event.people %}
        {% if p.id != obj.id %}
          <li><a href="{{ url_for('person_detail', obj_id=p.id) }}">{{ p }}</a></li>
        {% endif %}
      {% endfor %}
      </ul>
    </td>
    <td>
      {% if event.citations %}
        <ul>
        {% for c in event.citations %}
          <li><a href="{{ url_for('citation_detail', obj_id=c.id) }}" title="{{ c.source }}">{{ c.source.abbrev or c.source }}: {{ c }}</a></li>
        {% endfor %}
        <ul>
      {% endif %}
    </td>
  </tr>
{% endfor %}
</table>


<h2>Debug</h2>
<dl class="dl-horizontal">
{% for key in obj._data %}
    <dt><code>{{ key }}</code></dt>
    <dd><code>{{ obj._data[key]|pprint }}</code></dd>
{% endfor %}
</dl>

{% endblock %}
